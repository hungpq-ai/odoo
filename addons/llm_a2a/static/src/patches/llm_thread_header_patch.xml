<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <!-- Extend the LLMThreadHeader template to add A2A Agents dropdown -->
    <t t-inherit="llm_thread.LLMThreadHeader" t-inherit-mode="extension">
        <!-- Add A2A Agents dropdown after Tools dropdown -->
        <xpath expr="//Dropdown[last()]" position="after">
            <!-- A2A Agents Dropdown -->
            <Dropdown t-if="availableA2aAgents.length > 0">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                    <i class="fa fa-share-alt me-1" />
                    A2A Agents
                    <t t-if="currentA2aAgents.length > 0">
                        (<t t-esc="currentA2aAgents.length" />)
                    </t>
                </button>
                <t t-set-slot="content">
                    <div style="max-height: 300px; overflow-y: auto; min-width: 280px;">
                        <!-- Header info -->
                        <div class="px-3 py-2 text-muted small border-bottom">
                            <i class="fa fa-info-circle me-1" />
                            Select agents to delegate tasks
                        </div>

                        <!-- Agent List -->
                        <t t-foreach="availableA2aAgents" t-as="agent" t-key="agent.id">
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        t-att-id="'a2a_agent_' + agent.id"
                                        t-att-checked="isA2aAgentSelected(agent)"
                                        t-att-disabled="state.isLoadingUpdate"
                                        t-on-change="() => this.toggleA2aAgent(agent)"
                                    />
                                    <label
                                        class="form-check-label w-100"
                                        t-att-for="'a2a_agent_' + agent.id"
                                        t-att-class="{'text-muted': state.isLoadingUpdate}"
                                    >
                                        <div class="d-flex flex-column">
                                            <span class="fw-medium" t-esc="agent.name" />
                                            <small
                                                t-if="agent.description"
                                                class="text-muted text-truncate"
                                                style="max-width: 220px;"
                                                t-esc="agent.description"
                                            />
                                            <small
                                                t-if="agent.skills"
                                                class="text-primary"
                                            >
                                                <i class="fa fa-tags me-1" />
                                                <t t-esc="agent.skills" />
                                            </small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </t>

                        <!-- Loading state -->
                        <div
                            t-if="state.isLoadingA2aAgents"
                            class="dropdown-item-text text-center"
                        >
                            <i class="fa fa-spinner fa-spin me-1" />
                            Loading agents...
                        </div>

                        <!-- Empty state -->
                        <div
                            t-if="!state.isLoadingA2aAgents and availableA2aAgents.length === 0"
                            class="dropdown-item-text text-muted"
                        >
                            <i class="fa fa-plug me-1" />
                            No A2A agents available
                        </div>
                    </div>
                </t>
            </Dropdown>
        </xpath>
    </t>
</templates>
