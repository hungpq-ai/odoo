<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <!-- Extend mail.Message to add LLM-specific message rendering -->
    <t
    t-name="mail.Message"
    t-inherit="mail.Message"
    t-inherit-mode="extension"
  >
        <!-- Add LLM-specific content after the main message content -->
        <xpath
      expr="//div[hasclass('o-mail-Message-content')]"
      position="inside"
    >
            <!-- Tool Message Display -->
            <t t-if="isToolMessage">
                <LLMToolMessage message="message" />
            </t>

            <!-- Assistant Message with Tool Calls -->
            <t t-if="hasToolCalls">
                <div
          class="o_llm_tool_calls mt-2 small text-muted border-top pt-2"
        >
                    <strong class="me-2">Tools Requested:</strong>
                    <t
            t-foreach="message.body_json.tool_calls"
            t-as="toolCall"
            t-key="toolCall.id"
          >
                        <span
              class="badge bg-light text-dark border me-1 mb-1"
              t-att-title="'ID: ' + toolCall.id"
            >
                            <i class="fa fa-cog me-1" aria-hidden="true" />
                            <t
                t-esc="toolCall.function and toolCall.function.name or 'Unknown Tool'"
              />
                        </span>
                    </t>
                </div>
            </t>

            <!-- Feedback buttons for assistant messages -->
            <t t-if="isAssistantMessage">
                <div class="o_llm_feedback mt-2 pt-2 border-top d-flex align-items-center gap-2">
                    <span class="text-muted small me-1">Was this helpful?</span>
                    <button
                        t-att-class="'btn btn-sm ' + (message.user_vote === 1 ? 'btn-success' : 'btn-outline-secondary')"
                        t-on-click="() => this.onVote(1)"
                        title="Like"
                    >
                        <i class="fa fa-thumbs-up"/>
                    </button>
                    <button
                        t-att-class="'btn btn-sm ' + (message.user_vote === -1 ? 'btn-danger' : 'btn-outline-secondary')"
                        t-on-click="() => this.onVote(-1)"
                        title="Dislike"
                    >
                        <i class="fa fa-thumbs-down"/>
                    </button>
                </div>
            </t>
        </xpath>
    </t>
</templates>
