<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <t t-name="llm_thread.LLMChatContainer">
        <div class="o_LLMChatContainer h-100 d-flex flex-row overflow-hidden">
            <!-- Mobile: Backdrop overlay -->
            <t t-if="isSmall">
                <div
          class="o-llm-sidebar-backdrop"
          t-att-class="{ 'o-visible': state.isMobileSidebarVisible }"
          t-on-click="onBackdropClick"
        />
            </t>

            <!-- Mobile Sidebar: Slide-in from left (shown when isSmall = true) -->
            <div
        t-if="isSmall"
        class="o-llm-sidebar d-flex flex-column border-end"
        t-att-class="{
                    'o-mobile': true,
                    'o-visible': state.isMobileSidebarVisible
                }"
      >
                <!-- Sidebar Header -->
                <div
          class="o-llm-sidebar-header d-flex align-items-center justify-content-between border-bottom p-3"
        >
                    <h5 class="mb-0 text-white">Conversations</h5>
                    <button
            class="btn btn-sm btn-primary"
            t-on-click="createNewThread"
            title="New Thread"
          >
                        <i class="fa fa-plus" />
                    </button>
                </div>

                <!-- Thread List -->
                <div class="flex-grow-1 overflow-auto">
                    <!-- Empty State -->
                    <div
            t-if="filteredThreadList.length === 0"
            class="p-3 text-center text-muted"
          >
                        <i class="fa fa-comments-o fa-2x mb-2" />
                        <div>No conversations yet</div>
                        <small>Start your first AI chat</small>
                    </div>

                    <!-- Thread Items -->
                    <t
            t-foreach="filteredThreadList"
            t-as="thread"
            t-key="thread.id"
          >
                        <div
              class="o-llm-thread-item p-3 border-bottom cursor-pointer position-relative"
              t-att-class="{ 'o-llm-thread-active': thread.id === activeThread?.id }"
              t-on-click.stop.prevent="() => this.selectThread(thread.id)"
              t-att-title="thread.name"
            >
                            <div
                class="d-flex justify-content-between align-items-start"
              >
                                <div class="flex-grow-1 min-width-0">
                                    <!-- Inline rename input -->
                                    <t t-if="state.editingThreadId === thread.id">
                                        <input
                      type="text"
                      class="form-control form-control-sm o-llm-rename-input"
                      t-att-value="state.editingName"
                      t-on-input="onRenameInputChange"
                      t-on-keydown="onRenameKeydown"
                      t-on-blur="saveRename"
                      t-on-click.stop=""
                    />
                                    </t>
                                    <t t-else="">
                                        <div
                      class="text-truncate fw-medium"
                      t-esc="thread.name"
                    />
                                        <div class="text-muted small mt-1">
                                            <span
                        t-if="thread.write_date"
                        t-esc="formatDate(thread.write_date)"
                      />
                                        </div>
                                    </t>
                                </div>
                                <div class="ms-2 flex-shrink-0 d-flex align-items-center gap-1" t-if="state.editingThreadId !== thread.id">
                                    <i
                    t-if="isStreamingThread(thread.id)"
                    class="fa fa-circle-o-notch fa-spin text-primary"
                  />
                                    <!-- Thread menu dropdown -->
                                    <div class="dropdown o-llm-thread-menu">
                                        <button
                      class="btn btn-sm btn-link text-muted p-0"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      t-on-click.stop=""
                    >
                                            <i class="fa fa-ellipsis-v" />
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li>
                                                <a
                          class="dropdown-item"
                          href="#"
                          t-on-click.stop.prevent="(ev) => this.onRenameThread(ev, thread.id, thread.name)"
                        >
                                                    <i class="fa fa-pencil me-2" />Rename
                                                </a>
                                            </li>
                                            <li><hr class="dropdown-divider" /></li>
                                            <li>
                                                <a
                          class="dropdown-item text-danger"
                          href="#"
                          t-on-click.stop.prevent="(ev) => this.onDeleteThread(ev, thread.id)"
                        >
                                                    <i class="fa fa-trash me-2" />Delete
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>

            <!-- Desktop Sidebar: Expand/collapse pattern (shown when isSmall = false) -->
            <div
        t-if="!isSmall"
        class="o-llm-sidebar d-flex flex-column border-end"
        t-att-style="state.isSidebarCollapsed ? 'width: 48px;' : 'width: 280px;'"
      >
                <!-- Sidebar Header - matches height of chat header -->
                <div
          class="o-llm-sidebar-header d-flex align-items-center border-bottom"
          t-att-class="state.isSidebarCollapsed ? 'justify-content-center px-2 py-3' : 'justify-content-between p-3'"
        >
                    <!-- Expanded state: Header content + collapse button on right -->
                    <t t-if="!state.isSidebarCollapsed">
                        <div class="d-flex align-items-center gap-2">
                            <h5 class="mb-0 text-white">Conversations</h5>
                            <button
                class="btn btn-sm btn-primary"
                t-on-click="createNewThread"
                title="New Thread"
              >
                                <i class="fa fa-plus" />
                            </button>
                        </div>
                        <!-- Collapse button (Odoo Apps style classes) -->
                        <button
              class="btn btn-secondary btn-sm px-2 py-1"
              t-on-click="toggleSidebar"
              title="Collapse sidebar"
            >
                            <i class="oi oi-panel-right" />
                        </button>
                    </t>

                    <!-- Collapsed state: Centered expand button -->
                    <t t-else="">
                        <button
              class="btn btn-secondary btn-sm px-2 py-1"
              t-on-click="toggleSidebar"
              title="Expand sidebar"
            >
                            <i
                class="oi oi-panel-right"
                style="transform: rotate(180deg);"
              />
                        </button>
                    </t>
                </div>

                <!-- Thread List (only when expanded) -->
                <div
          t-if="!state.isSidebarCollapsed"
          class="flex-grow-1 overflow-auto"
        >
                    <div
            t-if="filteredThreadList.length === 0"
            class="p-3 text-center text-muted"
          >
                        <i class="fa fa-comments-o fa-2x mb-2" />
                        <div>No conversations yet</div>
                        <small>Start your first AI chat</small>
                    </div>

                    <t
            t-foreach="filteredThreadList"
            t-as="thread"
            t-key="thread.id"
          >
                        <div
              class="o-llm-thread-item p-3 border-bottom cursor-pointer position-relative"
              t-att-class="{ 'o-llm-thread-active': thread.id === activeThread?.id }"
              t-on-click.stop.prevent="() => this.selectThread(thread.id)"
              t-att-title="thread.name"
            >
                            <div
                class="d-flex justify-content-between align-items-start"
              >
                                <div class="flex-grow-1 min-width-0">
                                    <!-- Inline rename input -->
                                    <t t-if="state.editingThreadId === thread.id">
                                        <input
                      type="text"
                      class="form-control form-control-sm o-llm-rename-input"
                      t-att-value="state.editingName"
                      t-on-input="onRenameInputChange"
                      t-on-keydown="onRenameKeydown"
                      t-on-blur="saveRename"
                      t-on-click.stop=""
                    />
                                    </t>
                                    <t t-else="">
                                        <div
                      class="text-truncate fw-medium"
                      t-esc="thread.name"
                    />
                                        <div class="text-muted small mt-1">
                                            <span
                        t-if="thread.write_date"
                        t-esc="formatDate(thread.write_date)"
                      />
                                        </div>
                                    </t>
                                </div>
                                <div class="ms-2 flex-shrink-0 d-flex align-items-center gap-1" t-if="state.editingThreadId !== thread.id">
                                    <i
                    t-if="isStreamingThread(thread.id)"
                    class="fa fa-circle-o-notch fa-spin text-primary"
                  />
                                    <!-- Thread menu dropdown -->
                                    <div class="dropdown o-llm-thread-menu">
                                        <button
                      class="btn btn-sm btn-link text-muted p-0"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      t-on-click.stop=""
                    >
                                            <i class="fa fa-ellipsis-v" />
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li>
                                                <a
                          class="dropdown-item"
                          href="#"
                          t-on-click.stop.prevent="(ev) => this.onRenameThread(ev, thread.id, thread.name)"
                        >
                                                    <i class="fa fa-pencil me-2" />Rename
                                                </a>
                                            </li>
                                            <li><hr class="dropdown-divider" /></li>
                                            <li>
                                                <a
                          class="dropdown-item text-danger"
                          href="#"
                          t-on-click.stop.prevent="(ev) => this.onDeleteThread(ev, thread.id)"
                        >
                                                    <i class="fa fa-trash me-2" />Delete
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="flex-grow-1 d-flex flex-column h-100">
                <!-- Mobile: Hamburger button to open sidebar + Cog for settings -->
                <div
          t-if="isSmall and hasActiveThread"
          class="d-flex align-items-center p-2 border-bottom flex-shrink-0"
        >
                    <button
            class="btn btn-sm btn-secondary me-2"
            t-on-click="openMobileSidebar"
            title="Show conversations"
          >
                        <i class="fa fa-bars" />
                    </button>
                    <h6
            class="mb-0 text-truncate flex-grow-1 me-2"
            t-esc="activeThread.name"
          />
                    <button
            class="btn btn-sm btn-secondary"
            t-on-click="openThreadSettings"
            title="Thread settings"
          >
                        <i class="fa fa-cog" />
                    </button>
                </div>

                <!-- Show thread and composer only if we have an active LLM thread -->
                <div
          t-if="hasActiveThread"
          class="d-flex flex-column flex-grow-1 overflow-hidden"
        >
                    <!-- Thread Header with dropdowns (desktop only) -->
                    <LLMThreadHeader t-if="!isSmall" thread="activeThread" />

                    <!-- Thread area - reuse mail's Thread component -->
                    <div
            t-ref="threadScrollable"
            class="o-llm-thread-area flex-grow-1 overflow-auto p-3"
            style="min-height: 0;"
          >
                        <Thread
              thread="activeThread"
              order="'asc'"
              scrollRef="threadScrollableRef"
            />
                    </div>

                    <!-- Streaming indicator with typing animation -->
                    <div
            t-if="isStreaming"
            class="o-llm-streaming-indicator flex-shrink-0"
          >
                        <div class="o-llm-typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span>AI is generating response...</span>
                    </div>

                    <!-- Composer area - reuse mail's Composer component -->
                    <div
            class="o-llm-composer-area border-top p-3 flex-shrink-0"
          >
                        <Composer
              t-if="threadComposer"
              composer="threadComposer"
              mode="'compact'"
              sidebar="false"
            />
                    </div>
                </div>

                <!-- Empty state with create button -->
                <div
          t-else=""
          class="d-flex justify-content-center align-items-center h-100 text-muted"
        >
                    <div class="text-center" style="max-width: 400px;">
                        <div class="mb-4">
                            <i class="fa fa-robot" style="font-size: 4rem; color: #10a37f; opacity: 0.8;" />
                        </div>
                        <h5 style="font-size: 1.5rem; font-weight: 600; color: #1a1a1a; margin-bottom: 0.75rem;">Welcome to AI Chat</h5>
                        <p style="color: #666; font-size: 1rem; margin-bottom: 1.5rem; line-height: 1.6;">Start a conversation with AI assistant. Ask questions, get help with code, or explore ideas.</p>
                        <button
              class="btn btn-primary"
              t-on-click="createNewThread"
              style="padding: 0.75rem 2rem; font-size: 1rem; border-radius: 0.75rem; background-color: #10a37f; border-color: #10a37f;"
            >
                            <i class="fa fa-plus me-2" /> Start New Conversation
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
